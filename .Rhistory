for(i in 1:G){
zMu[i] <- 0
}
zInvCovMat ~ dwish(zRmat[1:G,1:G], G)
}"
cat("model{
for(i in 1:(N-1)){
for(j in (i+1):N){
xsim[j,i] <- xsim[i,j]
xsim[i,j] ~ dpois(mu[i,j])
x[i,j] ~ dpois(mu[i,j])
mu[j,i] <- mu[i,j]
mu[i,j] <- lambda[i,j]*effort[i,j]
lambda[j,i] <- lambda[i,j]
log(lambda[i,j]) <- b0 - d[i,j] + re[i] + re[j] + b1*age[i] + b1*age[j] + b2*sex[i] + b2*sex[j] + b3*age[i]*sex[i] + b3*age[j]*sex[j] + b4*(1-abs(sex[i]-sex[j])) + b5*(-1*abs(age[i]-age[j])) + b6*kin[i,j]
d[j,i] <- d[i,j] #symmetrize
d[i,j] <- sqrt(sum((z[i,1:G]-z[j,1:G])^2)) #get the distances from estimates of z
}
}
b0 ~ dnorm(0,0.0001)
b1 ~ dnorm(0,0.0001)
b2 ~ dnorm(0,0.0001)
b3 ~ dnorm(0,0.0001)
b4 ~ dnorm(0,0.0001)
b5 ~ dnorm(0,0.0001)
b6 ~ dnorm(0,0.0001)
for(i in 1:N){
re[i] ~ dnorm(0,tau.ind)
xsim[i,i] <- 0
d[i,i] <- 0
lambda[i,i] <- 0
z[i,1:G] ~ dmnorm(zMu, zInvCovMat[1:G,1:G])
}
tau.ind <- pow(sigma.ind,-2)
sigma.ind ~ dgamma(0.1,0.1)
for(i in 1:G){
zMu[i] <- 0
}
zInvCovMat ~ dwish(zRmat[1:G,1:G], G)
}", file="latent_model.jags")
fit <- run.jags(model = filestring, data = jags_data, monitor = c("z","b0","b1","b2","b3","b4","b5","b6","sigma.ind"), adapt = 10000, burnin = 20000, sample = 500000)
formula = srkw_contact ~ srkw_kinship
fm <- formula
formula <- stats::model.frame(formula, na.action = NULL)
i <- attr(attr(formula, "terms"), "response")
response <- as.matrix(formula[i])
x_names <- attr(attr(formula, "terms"), "term.labels")
predictors <- list()
formula
i <- attr(attr(formula, "terms"), "response")
response <- as.matrix(formula[i])
x_names <- attr(attr(formula, "terms"), "term.labels")
predictors <- list()
for (i in 1:length(x_names)) {
predictors[[i]] <- as.matrix(formula[[x_names[i]]])
}
predictors[[i]]
same_sex <- attribute_similarity(attributes$sex)
same_sex <- attribute_similarity(srkw_attributes$sex)
same_sex
fm <- formula
formula <- stats::model.frame(formula, na.action = NULL)
i <- attr(attr(formula, "terms"), "response")
response <- as.matrix(formula[i])
x_names <- attr(attr(formula, "terms"), "term.labels")
predictors <- list()
for (i in 1:length(x_names)) {
predictors[[i]] <- as.matrix(formula[[x_names[i]]])
}
predictors
fm <- formula
formula <- stats::model.frame(formula, na.action = NULL)
i <- attr(attr(formula, "terms"), "response")
response <- as.matrix(formula[i])
x_names <- attr(attr(formula, "terms"), "term.labels")
for (i in 1:length(x_names)) {
predictors[[i]] <- as.matrix(formula[[x_names[i]]])
}
pred_array <- array(dim = c(length(x_names), ncol(predictors[[1]]), nrow(predictors[[1]])))
pred_array
pred_array <- array(dim = c(length(x_names), ncol(predictors[[1]]), nrow(predictors[[1]])))
for(i in 1:length(x_names)){
pred_array[i,,] <- predictors[[i]]
}
pred_array
pred_array[1,,]
pred_array[2,,]
length(x_names)
formula <- stats::model.frame(formula, na.action = NULL)
fm <- formula
formula <- stats::model.frame(formula, na.action = NULL)
i <- attr(attr(formula, "terms"), "response")
response <- as.matrix(formula[i])
x_names <- attr(attr(formula, "terms"), "term.labels")
for (i in 1:length(x_names)) {
predictors[[i]] <- as.matrix(formula[[x_names[i]]])
}
pred_array <- array(dim = c(length(x_names), ncol(predictors[[1]]), nrow(predictors[[1]])))
for(i in 1:length(x_names)){
pred_array[i,,] <- predictors[[i]]
}
pred_array[2,]
pred_array[2,,]
formula
formula <- srkw_contact ~ same_sex + srkw_kinship
r2jags
require(rjags)
require(runjags)
setwd("C:/Users/mw607/OneDrive - University of Exeter") #change to the directory where you've saved the data
require(mgcv)
require(asnipe)
require(rjags)
require(runjags)
source("C:/Users/mw607/OneDrive - University of Exeter/General code/load_broadscale_networks.R")
i = 1
id <- colnames(matrices[[i]])
id
source("C:/Users/mw607/OneDrive - University of Exeter/General code/load_finescale_networks.R")
matrices <- list()
d.mat <- list()
for(i in 1:length(years)){
alive <- with(attributes, id[yob < (years[i]) & (is.na(yod)|yod>years[i])])
sp.y <- sp[format(all_assoc_days,'%Y') == years[i],colnames(sp)%in%alive,colnames(sp)%in%alive]
id <- colnames(sp.y)
s.y <- sighted[format(all_assoc_days,"%Y")==years[i],id]
sp.y <- sp.y[,colSums(s.y) >= 1,colSums(s.y) >= 1]
s.y <- s.y[,colSums(s.y) >= 1]
x <- apply(sp.y,c(2,3),sum)
yab <- apply(s.y,2,function(x)colSums(x*s.y))
ya <- apply(s.y,2,function(x)colSums(x*(1-s.y)))
yb <- t(ya)
d <- yab
d.mat[[i]] <- d
sri <- x/d
sri[is.na(sri)] <- 0
matrices[[i]] <- sri
}
source("C:/Users/mw607/OneDrive - University of Exeter/General code/load_finescale_networks.R")
source("C:/Users/mw607/OneDrive - University of Exeter/General code/load_finescale_networks.R")
sex <- attributes$sex..0...females..1...males..2...uknown.[match(id,attributes$id)]
id <- colnames(matrices[[i]])
age <- yeasr[i] - attributes$yob[match(id,attributes$id)]
sex <- attributes$sex..0...females..1...males..2...uknown.[match(id,attributes$id)]
id <- colnames(matrices[[i]])
age <- years[i] - attributes$yob[match(id,attributes$id)]
sex <- attributes$sex..0...females..1...males..2...uknown.[match(id,attributes$id)]
sex
age
id
id <- colnames(matrices[[i]])
age <- years[i] - attributes$yob[match(id,attributes$id)]
sex <- attributes$sex..0...females..1...males..2...uknown.[match(id,attributes$id)]
str_f <- colSums(m[,sex==0&age>=10])
str_m <- colSums(m[,sex==1&age>=10])
str_i <- colSums(m[,age<10])
m <- matrices[[i]]
id <- colnames(matrices[[i]])
age <- years[i] - attributes$yob[match(id,attributes$id)]
sex <- attributes$sex..0...females..1...males..2...uknown.[match(id,attributes$id)]
str_f <- colSums(m[,sex==0&age>=10])
str_m <- colSums(m[,sex==1&age>=10])
str_i <- colSums(m[,age<10])
str_f
str_m
str_i
str_f <- colSums(m[,sex==0&age>=10])
str_m <- colSums(m[,sex==1&age>=10])
str_i <- colSums(m[,age<10])
str_f <- as.numeric(scale(str_f))
str_m <- as.numeric(scale(str_m))
str_i <- as.numeric(scale(str_i))
str_f
str_m
str_i
b0 <- sapply(id,function(z) ifelse(
any(attributes$yob == years[i] & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)
}
b0 <- sapply(id,function(z) {ifelse(
any(attributes$yob == years[i] & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
b0
m <- matrices[[i]]
id <- colnames(matrices[[i]])
age <- years[i] - attributes$yob[match(id,attributes$id)]
sex <- attributes$sex..0...females..1...males..2...uknown.[match(id,attributes$id)]
str_f <- colSums(m[,sex==0&age>=10])
str_m <- colSums(m[,sex==1&age>=10])
str_i <- colSums(m[,age<10])
str_f <- as.numeric(scale(str_f))
str_m <- as.numeric(scale(str_m))
str_i <- as.numeric(scale(str_i))
b0 <- sapply(id,function(z) {ifelse(
any(attributes$yob == years[i] & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
b1 <- sapply(id,function(z) {ifelse(
any(attributes$yob == (years[i]+1) & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
b2 <- sapply(id,function(z) {ifelse(
any(attributes$yob == (years[i]+2) & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
yod <- attributes$yod[match(id,attributes$id)]
die <- ifelse(is.na(attributes$yod) | attributes$yod >= (years[i]+1),1,0)
female_data <- list()
female_data <- list()
for(i in 1:length(years)){
m <- matrices[[i]]
id <- colnames(matrices[[i]])
age <- years[i] - attributes$yob[match(id,attributes$id)]
sex <- attributes$sex..0...females..1...males..2...uknown.[match(id,attributes$id)]
str <- colSums(m)
str_f <- colSums(m[,sex==0&age>=9])
str_m <- colSums(m[,sex==1&age>=9])
str_i <- colSums(m[,age<10])
b0 <- sapply(id,function(z) {ifelse(
any(attributes$yob == years[i] & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
b1 <- sapply(id,function(z) {ifelse(
any(attributes$yob == (years[i]+1) & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
b2 <- sapply(id,function(z) {ifelse(
any(attributes$yob == (years[i]+2) & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
yod <- attributes$yod[match(id,attributes$id)]
die <- ifelse(is.na(attributes$yod) | attributes$yod >= (years[i]+1),1,0)
id <- id[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
b1 <- b1[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str_f <- str_f[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str_m <- str_m[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str_i <- str_i[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str <- str[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
age <- age[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str <- as.numeric(scale(str))
str_f <- as.numeric(scale(str_f))
str_m <- as.numeric(scale(str_m))
str_i <- as.numeric(scale(str_i))
female_data[[i]] <- data.frame(id,age,str,str_f,str_m,str_i,b1,year=years[i])
}
warnings()
m <- matrices[[i]]
id <- colnames(matrices[[i]])
age <- years[i] - attributes$yob[match(id,attributes$id)]
sex <- attributes$sex..0...females..1...males..2...uknown.[match(id,attributes$id)]
str <- colSums(m)
str_f <- colSums(m[,sex==0&age>=9])
str_m <- colSums(m[,sex==1&age>=9])
str_i <- colSums(m[,age<10])
b0 <- sapply(id,function(z) {ifelse(
any(attributes$yob == years[i] & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
b1 <- sapply(id,function(z) {ifelse(
any(attributes$yob == (years[i]+1) & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
b2 <- sapply(id,function(z) {ifelse(
any(attributes$yob == (years[i]+2) & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
length(id)
length(age)
length(sex)
length(b0)
length(b1)
length(b2)
id <- id[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
m <- matrices[[i]]
id <- colnames(matrices[[i]])
age <- years[i] - attributes$yob[match(id,attributes$id)]
sex <- attributes$sex..0...females..1...males..2...uknown.[match(id,attributes$id)]
str <- colSums(m)
str_f <- colSums(m[,sex==0&age>=9])
str_m <- colSums(m[,sex==1&age>=9])
str_i <- colSums(m[,age<10])
b0 <- sapply(id,function(z) {ifelse(
any(attributes$yob == years[i] & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
b1 <- sapply(id,function(z) {ifelse(
any(attributes$yob == (years[i]+1) & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
b2 <- sapply(id,function(z) {ifelse(
any(attributes$yob == (years[i]+2) & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
yod <- attributes$yod[match(id,attributes$id)]
die <- ifelse(is.na(attributes$yod) | attributes$yod >= (years[i]+1),1,0)
length(die)
female_data <- list()
for(i in 1:length(years)){
m <- matrices[[i]]
id <- colnames(matrices[[i]])
age <- years[i] - attributes$yob[match(id,attributes$id)]
sex <- attributes$sex..0...females..1...males..2...uknown.[match(id,attributes$id)]
str <- colSums(m)
str_f <- colSums(m[,sex==0&age>=9])
str_m <- colSums(m[,sex==1&age>=9])
str_i <- colSums(m[,age<10])
b0 <- sapply(id,function(z) {ifelse(
any(attributes$yob == years[i] & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
b1 <- sapply(id,function(z) {ifelse(
any(attributes$yob == (years[i]+1) & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
b2 <- sapply(id,function(z) {ifelse(
any(attributes$yob == (years[i]+2) & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
yod <- attributes$yod[match(id,attributes$id)]
die <- ifelse(is.na(yod) | yod >= (years[i]+1),1,0)
id <- id[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
b1 <- b1[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str_f <- str_f[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str_m <- str_m[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str_i <- str_i[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str <- str[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
age <- age[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str <- as.numeric(scale(str))
str_f <- as.numeric(scale(str_f))
str_m <- as.numeric(scale(str_m))
str_i <- as.numeric(scale(str_i))
female_data[[i]] <- data.frame(id,age,str,str_f,str_m,str_i,b1,year=years[i])
}
length(id)
i = 1
m <- matrices[[i]]
id <- colnames(matrices[[i]])
age <- years[i] - attributes$yob[match(id,attributes$id)]
sex <- attributes$sex..0...females..1...males..2...uknown.[match(id,attributes$id)]
str <- colSums(m)
str_f <- colSums(m[,sex==0&age>=9])
str_m <- colSums(m[,sex==1&age>=9])
str_i <- colSums(m[,age<10])
b0 <- sapply(id,function(z) {ifelse(
any(attributes$yob == years[i] & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
b1 <- sapply(id,function(z) {ifelse(
any(attributes$yob == (years[i]+1) & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
b2 <- sapply(id,function(z) {ifelse(
any(attributes$yob == (years[i]+2) & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
yod <- attributes$yod[match(id,attributes$id)]
die <- ifelse(is.na(yod) | yod > (years[i]+1),0,1)
id <- id[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
b1 <- b1[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str_f <- str_f[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str_m <- str_m[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str_i <- str_i[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str <- str[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
age <- age[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str <- as.numeric(scale(str))
str_f <- as.numeric(scale(str_f))
str_m <- as.numeric(scale(str_m))
str_i <- as.numeric(scale(str_i))
female_data[[i]] <- data.frame(id,age,str,str_f,str_m,str_i,b1,year=years[i])
female_data <- list()
for(i in 1:length(years)){
m <- matrices[[i]]
id <- colnames(matrices[[i]])
age <- years[i] - attributes$yob[match(id,attributes$id)]
sex <- attributes$sex..0...females..1...males..2...uknown.[match(id,attributes$id)]
str <- colSums(m)
str_f <- colSums(m[,sex==0&age>=9])
str_m <- colSums(m[,sex==1&age>=9])
str_i <- colSums(m[,age<10])
b0 <- sapply(id,function(z) {ifelse(
any(attributes$yob == years[i] & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
b1 <- sapply(id,function(z) {ifelse(
any(attributes$yob == (years[i]+1) & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
b2 <- sapply(id,function(z) {ifelse(
any(attributes$yob == (years[i]+2) & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
yod <- attributes$yod[match(id,attributes$id)]
die <- ifelse(is.na(yod) | yod > (years[i]+1),0,1)
id <- id[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
b1 <- b1[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str_f <- str_f[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str_m <- str_m[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str_i <- str_i[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str <- str[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
age <- age[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str <- as.numeric(scale(str))
str_f <- as.numeric(scale(str_f))
str_m <- as.numeric(scale(str_m))
str_i <- as.numeric(scale(str_i))
female_data[[i]] <- data.frame(id,age,str,str_f,str_m,str_i,b1,year=years[i])
}
female_data <- do.call(rbind,female_data)
require(mgcv)
gam(b1 ~ s(age) + s(id,bs="re") + s(year) + str, data = female_data, family = binomial())
summary(gam(b1 ~ s(age) + s(id,bs="re") + s(year) + str, data = female_data, family = binomial()))
summary(gam(b1 ~ s(age) + s(id,bs="re") + s(year) + str_f + str_m + str_i, data = female_data, family = binomial()))
summary(gam(b1 ~ s(age) + s(id,bs="re") + str_f + str_m + str_i, data = female_data, family = binomial()))
plot(gam(b1 ~ s(age) + s(id,bs="re") + str_f + str_m + str_i, data = female_data, family = binomial()))
nrow(female_data)
sum(female_data$b1)
female_data$year <- as.factor(female_data$year)
plot(gam(b1 ~ s(age) + s(id,bs="re") + s(year,bs = "re")+ str_f + str_m + str_i, data = female_data, family = binomial()))
summary(gam(b1 ~ s(age) + s(id,bs="re") + s(year,bs = "re")+ str_f + str_m + str_i, data = female_data, family = binomial()))
summary(gam(b1 ~ s(age) + s(id,bs="re") + s(year,bs = "re")+ str_f, data = female_data, family = binomial()))
summary(gam(b1 ~ s(age) + s(id,bs="re") + s(year,bs = "re")+ str_m, data = female_data, family = binomial()))
female_data <- list()
for(i in 1:length(years)){
m <- matrices[[i]]
id <- colnames(matrices[[i]])
age <- years[i] - attributes$yob[match(id,attributes$id)]
sex <- attributes$sex..0...females..1...males..2...uknown.[match(id,attributes$id)]
str <- colMeans(m)
str_f <- colMeans(m[,sex==0&age>=15])
str_m <- colMeans(m[,sex==1&age>=15])
str_i <- colMeans(m[,age<15])
b0 <- sapply(id,function(z) {ifelse(
any(attributes$yob == years[i] & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
b1 <- sapply(id,function(z) {ifelse(
any(attributes$yob == (years[i]+1) & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
b2 <- sapply(id,function(z) {ifelse(
any(attributes$yob == (years[i]+2) & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
yod <- attributes$yod[match(id,attributes$id)]
die <- ifelse(is.na(yod) | yod > (years[i]+1),0,1)
id <- id[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
b1 <- b1[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str_f <- str_f[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str_m <- str_m[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str_i <- str_i[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str <- str[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
age <- age[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str <- as.numeric(scale(str))
str_f <- as.numeric(scale(str_f))
str_m <- as.numeric(scale(str_m))
str_i <- as.numeric(scale(str_i))
female_data[[i]] <- data.frame(id,age,str,str_f,str_m,str_i,b1,year=years[i])
}
female_data <- do.call(rbind,female_data)
female_data$year <- as.factor(female_data$year)
summary(gam(b1 ~ s(age) + s(id,bs="re") + s(year,bs = "re")+ str_m, data = female_data, family = binomial()))
summary(gam(b1 ~ s(age) + s(id,bs="re") + s(year,bs = "re")+ str_f, data = female_data, family = binomial()))
summary(gam(b1 ~ s(age) + s(id,bs="re") + s(year,bs = "re")+ str_i, data = female_data, family = binomial()))
female_data <- list()
for(i in 1:length(years)){
m <- matrices[[i]]
id <- colnames(matrices[[i]])
age <- years[i] - attributes$yob[match(id,attributes$id)]
sex <- attributes$sex..0...females..1...males..2...uknown.[match(id,attributes$id)]
str <- colMeans(m)
str_f <- colMeans(m[,sex==0&age>=15])
str_m <- colMeans(m[,sex==1&age>=15])
str_i <- colMeans(m[,age<15])
b0 <- sapply(id,function(z) {ifelse(
any(attributes$yob == years[i] & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
b1 <- sapply(id,function(z) {ifelse(
any(attributes$yob == (years[i]+1) & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
b2 <- sapply(id,function(z) {ifelse(
any(attributes$yob == (years[i]+2) & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
yod <- attributes$yod[match(id,attributes$id)]
die <- ifelse(is.na(yod) | yod > (years[i]+1),0,1)
id <- id[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
b1 <- b1[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str_f <- str_f[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str_m <- str_m[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str_i <- str_i[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str <- str[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
age <- age[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
female_data[[i]] <- data.frame(id,age,str,str_f,str_m,str_i,b1,year=years[i])
}
female_data <- do.call(rbind,female_data)
female_data$year <- as.factor(female_data$year)
summary(gam(b1 ~ s(age) + s(id,bs="re") + s(year,bs = "re")+ str_m, data = female_data, family = binomial()))
summary(gam(b1 ~ s(age) + s(id,bs="re") + s(year,bs = "re")+ str_j, data = female_data, family = binomial()))
summary(gam(b1 ~ s(age) + s(id,bs="re") + s(year,bs = "re")+ str_i, data = female_data, family = binomial()))
summary(gam(b1 ~ s(age) + s(id,bs="re") + s(year,bs = "re")+ str_f, data = female_data, family = binomial()))
summary(gam(b1 ~ s(age) + s(id,bs="re") + s(year,bs = "re"), data = female_data, family = binomial()))
plot(gam(b1 ~ s(age) + s(id,bs="re") + s(year,bs = "re"), data = female_data, family = binomial()))
source("C:/Users/mw607/OneDrive - University of Exeter/General code/load_broadscale_networks.R")
female_data <- list()
for(i in 1:length(years)){
m <- matrices[[i]]
id <- colnames(matrices[[i]])
age <- years[i] - attributes$yob[match(id,attributes$id)]
sex <- attributes$sex..0...females..1...males..2...uknown.[match(id,attributes$id)]
str <- colMeans(m)
str_f <- colMeans(m[,sex==0&age>=15])
str_m <- colMeans(m[,sex==1&age>=15])
str_i <- colMeans(m[,age<15])
b0 <- sapply(id,function(z) {ifelse(
any(attributes$yob == years[i] & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
b1 <- sapply(id,function(z) {ifelse(
any(attributes$yob == (years[i]+1) & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
b2 <- sapply(id,function(z) {ifelse(
any(attributes$yob == (years[i]+2) & !is.na(attributes$mother) & as.character(attributes$mother) == z), 1, 0
)})
yod <- attributes$yod[match(id,attributes$id)]
die <- ifelse(is.na(yod) | yod > (years[i]+1),0,1)
id <- id[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
b1 <- b1[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str_f <- str_f[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str_m <- str_m[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str_i <- str_i[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
str <- str[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
age <- age[sex == 0 & age >= 9 & age <= 45 & die == 0 & b0 == 0 & b2 == 0]
female_data[[i]] <- data.frame(id,age,str,str_f,str_m,str_i,b1,year=years[i])
}
female_data <- do.call(rbind,female_data)
female_data$year <- as.factor(female_data$year)
summary(gam(b1 ~ s(age) + s(id,bs="re") + s(year,bs = "re"), data = female_data, family = binomial()))
summary(gam(b1 ~ s(age) + s(id,bs="re") + s(year,bs = "re") + str_f, data = female_data, family = binomial()))
summary(gam(b1 ~ s(age) + s(id,bs="re") + s(year,bs = "re") + str_f + str_m, data = female_data, family = binomial()))
summary(gam(b1 ~ s(age) + s(id,bs="re") + s(year,bs = "re") + str_f + str_m + str_i, data = female_data, family = binomial()))
